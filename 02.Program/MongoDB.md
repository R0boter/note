# MongoDB 基础

## NoSQL

Not Only SQL：非关系型数据库，是对不同于传统的关系型数据库的数据库管理系统的统称

特点：

- 没有声明性查询语言
- 没有预定义模式
- 以键值对形式存储、列存储、文档存储、图形数据库
- 最终一致性，而非 ACID 属性
- 非结构化和不可预知的数据
- CAP 定理
  - 在计算机科学中 CAP 定理又被称为**布鲁尔定理(Brewer's theorem)**，它指出对于一个分布式计算系统来说，不可能同时满足以下三点
    - 一致性(Consistency)：所有节点在同一时间具有相同的数据
    - 可用性(Availability)：保证每个请求不管成功或失败都有响应
    - 分隔容忍(Partition tolerance)：系统中任意信息的丢失或失败都不会影响系统的继续运作
  - CAP 理论的核心是：一个分布式系统不可能同时满足一致性、可用性、分区容错性这三个需求，最多只能同时较好的满足两个。因此根据 CAP 原理，NoSQL 数据库被分为满足 CA 原则、满足 CP 原则、满足 AP 原则三大类
    - CA：单点集群，满足一致性、可用性的系统，通常在可扩展性上不太强大
    - CP：满足一致性、分区容错性的系统，通常性能不是特别高
    - AP：满足可用性、分区容错性的系统，通常对一致性要求低一些
- 高性能、高可用性和可伸缩性

优缺点：

- 优点：
  - 高可扩展性
  - 分布式计算
  - 低成本
  - 架构的灵活性
  - 没有复杂的关系
- 缺点：
  - 没有标准化
  - 有限的查询功能
  - 最终一致是不直观的程序

非关系型数据库遵循的 BASE 原则：

BASE(Basically Available,Soft-state,Eventually Consistent)是 NoSQL 数据库通常对可用性及一致性的弱要求原则。由 Eric Brewer 定义

- Basically Available：基本可用
- Soft-state：软状态/柔性事务。也可以理解为“无连接”，而 Hard-state 是“面向连接”
- Eventually Consistent：最终一致性，也是关系型数据库 ACID 原则的最终目的

NoSQL 数据库分类
|      类型      |                      部分代表                       |                                                       特点                                                       |
| :------------: | :-------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------: |
|     列存储     |            Hbase、Cassandra、Hypertable             | 按列存储数据，最大特点是方便存储结构化和半结构化数据，方便数据压缩，对针对某一列或某几列的查询有非常大的 IO 优势 |
|    文档存储    |                  MongoDB、CouchDB                   |  文档存储一般用类似 json 的格式存储，存储的内容是文档型。这样可以对某些字段建立索引，实现关系型数据库的某些功能  |
| Key-value 存储 | Tokyo Cabinet/Tyrant Berkeley DB、MemcacheDB、Redis |     可以通过 key 快速查询到对应的 value，一般来说，存储不管 value 格式，照单全收。（Redis 包含了其他的功能）     |
|     图存储     |                   Neo4J、FlockDB                    |                   图形关系的最佳存储，使用传统关系数据库来解决的话性能低下，而且设计使用不方便                   |
|    对象存储    |                    db4o、Versant                    |                           通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据                           |
|   xml 数据库   |               Berkeley DB XML、BaseX                |                      高效的存储 XML 数据，并支持 XML 的内部查询语法，比如 XQuery、Xpath 等                       |

## MongoDB 简介

由 C++ 编写的一个基于分布式文件存储的开源数据库系统，在高负载的情况下添加更多的节点可以保证服务器性能，旨在为 WEB 应用提供可扩展的高性能数据存储解决方案

MongoDB 将数据存储为一个文档，数据结构由键值对组成，类似 JSON 对象。字段值可以包含其他文档、数组及文档数组

```mongoDB
{
    name:"leon",
    age:18,
    status:"A",
    groups:["news","sports"]
}
```

特点：

- MongoDB 是一个面向文档存储的数据库，操作起来比较简单和容易。、
- 可以在 MongoDB 记录中设置任何属性的索引 (如：FirstName="Sameer",Address="8 Gandhi Road")来实现更快的排序。
- 可以通过本地或者网络创建数据镜像，这使得 MongoDB 有更强的扩展性。
- 如果负载的增加（需要更多的存储空间和更强的处理能力） ，它可以分布在计算机网络中的其他节点上这就是所谓的分片。
- Mongo 支持丰富的查询表达式。查询指令使用 JSON 形式的标记，可轻易查询文档中内嵌的对象及数组。
- MongoDb 使用`update()`命令可以实现替换完成的文档（数据）或者一些指定的数据字段 。
- Mongodb 中的 Map/reduce 主要是用来对数据进行批量处理和聚合操作。
- Map 和 Reduce。Map 函数调用`emit(key,value)`遍历集合中所有的记录，将 key 与 value 传给 Reduce 函数进行处理。
- Map 函数和 Reduce 函数是使用 Javascript 编写的，并可以通过`db.runCommand`或`mapreduce`命令来执行 MapReduce 操作。
- GridFS 是 MongoDB 中的一个内置功能，可以用于存放大量小文件。
- MongoDB 允许在服务端执行脚本，可以用 Javascrip t 编写某个函数，直接在服务端执行，也可以把函数的定义存储在服务端，下次直接调用即可。
- MongoDB 支持各种编程语言:RUBY，PYTHON，JAVA，C++，PHP，C# 等多种语言。
- MongoDB 安装简单。

## MongoDB 基本概念

MongoDB 由集合构成，集合是一个文档组，类似关系型数据库中的表。集合规定了文档中的键名和值类型，集合相当于是文档的一个模板。

文档相当于关系型数据库中的行，一个文档中有多个字段，以键值对形式存储

字段相当于关系型数据库中的列，每个字段分为键和值，值可以是 MongoDB 中规定的任何数据类型（甚至是嵌入的整个文档）
